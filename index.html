<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FF Mestre - Survivor Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #0a0a0a; color: white; font-family: 'Arial Black', sans-serif; }
        canvas { display: block; cursor: crosshair; }
        #ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .hud-box { background: rgba(0,0,0,0.6); border-left: 4px solid #ff0000; padding: 10px; pointer-events: auto; }
        #overlay {
            position: absolute; inset: 0; background: radial-gradient(circle, rgba(50,0,0,0.8) 0%, rgba(0,0,0,0.95) 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100;
        }
        .btn-play {
            background: linear-gradient(to bottom, #ff4d4d, #800000);
            padding: 20px 60px; border-radius: 8px; font-size: 24px; cursor: pointer; border: 2px solid #ffcc00;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.5); pointer-events: auto; text-transform: uppercase;
        }
        .shake { animation: shake 0.2s; }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            40% { transform: translate(3px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            100% { transform: translate(0px, 0px) rotate(0deg); }
        }
    </style>
</head>
<body>

<div id="overlay">
    <div class="mb-6 text-center">
        <h1 class="text-6xl font-black text-red-600 italic tracking-tighter">BATTLE ROYALE</h1>
        <p class="text-yellow-500 text-xl font-bold">DESAFIO DO MESTRE</p>
    </div>
    <button class="btn-play" onclick="initGame()">ENTRAR NA PARTIDA</button>
    <p class="mt-8 text-gray-400 text-sm">WASD - MOVER | MOUSE - ATIRAR</p>
</div>

<div id="ui" class="p-6 hidden">
    <div class="flex justify-between items-start">
        <div class="hud-box">
            <div class="text-xs text-gray-400 uppercase">Saúde</div>
            <div class="w-64 h-5 bg-gray-900 border border-gray-700 mt-1">
                <div id="hp-bar" class="h-full bg-gradient-to-r from-red-700 to-red-500 w-full transition-all duration-300"></div>
            </div>
            <div class="text-xl font-bold italic" id="hp-val">100 HP</div>
        </div>
        <div class="hud-box text-right border-l-0 border-r-4 border-yellow-500">
            <div class="text-xs text-gray-400 uppercase">Patente Atual</div>
            <div id="rank-label" class="text-2xl font-black text-yellow-500 italic">PLATINA</div>
            <div class="text-lg" id="score-label">KILLS: 0</div>
        </div>
    </div>
</div>

<canvas id="game"></canvas>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    let gameRunning = false;
    let score = 0;
    let shakeTime = 0;
    
    const player = {
        x: 0, y: 0, radius: 20, angle: 0,
        hp: 100, speed: 5,
        color: '#ff3333'
    };

    let enemies = [];
    let bullets = [];
    let particles = [];
    let keys = {};

    // --- SISTEMA DE ÁUDIO (Sintetizador) ---
    function playShootSound() {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'square';
        osc.frequency.setValueAtTime(150, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
    }

    function playHitSound() {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(60, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.2);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.2);
    }

    function startBGM() {
        const notes = [110, 123, 130, 146]; // Bassline tensa
        let step = 0;
        setInterval(() => {
            if(!gameRunning) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(notes[step % notes.length], audioCtx.currentTime);
            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
            step++;
        }, 500);
    }

    // --- MECÂNICAS ---
    function createParticles(x, y, color) {
        for(let i=0; i<8; i++) {
            particles.push({
                x, y,
                vx: (Math.random() - 0.5) * 10,
                vy: (Math.random() - 0.5) * 10,
                life: 1.0,
                color
            });
        }
    }

    function initGame() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        document.getElementById('overlay').classList.add('hidden');
        document.getElementById('ui').classList.remove('hidden');
        gameRunning = true;
        score = 0;
        player.hp = 100;
        enemies = [];
        bullets = [];
        particles = [];
        resize();
        startBGM();
        spawnManager();
        requestAnimationFrame(update);
    }

    function spawnManager() {
        if(!gameRunning) return;
        let side = Math.floor(Math.random() * 4);
        let ex, ey;
        if(side === 0) { ex = -50; ey = Math.random() * canvas.height; }
        else if(side === 1) { ex = canvas.width + 50; ey = Math.random() * canvas.height; }
        else if(side === 2) { ex = Math.random() * canvas.width; ey = -50; }
        else { ex = Math.random() * canvas.width; ey = canvas.height + 50; }

        enemies.push({
            x: ex, y: ey,
            radius: 18,
            hp: 2,
            speed: 2 + (score/20)
        });
        setTimeout(spawnManager, Math.max(300, 1200 - (score * 5)));
    }

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        player.x = canvas.width / 2;
        player.y = canvas.height / 2;
    }

    window.addEventListener('resize', resize);
    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup', e => keys[e.code] = false);
    window.addEventListener('mousemove', e => {
        player.angle = Math.atan2(e.clientY - player.y, e.clientX - player.x);
    });
    window.addEventListener('mousedown', () => {
        if(!gameRunning) return;
        playShootSound();
        bullets.push({
            x: player.x + Math.cos(player.angle) * 30,
            y: player.y + Math.sin(player.angle) * 30,
            vx: Math.cos(player.angle) * 12,
            vy: Math.sin(player.angle) * 12
        });
    });

    function update() {
        if(!gameRunning) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Desenhar Fundo (Grid)
        ctx.strokeStyle = '#1a1a1a';
        ctx.lineWidth = 1;
        for(let i=0; i<canvas.width; i+=50) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); ctx.stroke(); }
        for(let i=0; i<canvas.height; i+=50) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); ctx.stroke(); }

        // Movimento Jogador
        if(keys['KeyW']) player.y -= player.speed;
        if(keys['KeyS']) player.y += player.speed;
        if(keys['KeyA']) player.x -= player.speed;
        if(keys['KeyD']) player.x += player.speed;

        // Desenhar Jogador (Sprite de Triângulo/Personagem)
        ctx.save();
        ctx.translate(player.x, player.y);
        ctx.rotate(player.angle);
        // Corpo
        ctx.fillStyle = '#ff4444';
        ctx.beginPath();
        ctx.moveTo(25, 0); ctx.lineTo(-15, -20); ctx.lineTo(-15, 20); ctx.closePath();
        ctx.fill();
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 3;
        ctx.stroke();
        // Mochila/Detalhe
        ctx.fillStyle = '#800000';
        ctx.fillRect(-10, -10, 10, 20);
        ctx.restore();

        // Partículas
        particles.forEach((p, i) => {
            p.x += p.vx; p.y += p.vy; p.life -= 0.02;
            ctx.globalAlpha = p.life;
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, 4, 4);
            if(p.life <= 0) particles.splice(i, 1);
        });
        ctx.globalAlpha = 1;

        // Bullets
        bullets.forEach((b, i) => {
            b.x += b.vx; b.y += b.vy;
            ctx.fillStyle = '#ffff00';
            ctx.beginPath();
            ctx.arc(b.x, b.y, 4, 0, Math.PI*2);
            ctx.fill();
            if(b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) bullets.splice(i, 1);
        });

        // Inimigos
        enemies.forEach((en, i) => {
            let dx = player.x - en.x;
            let dy = player.y - en.y;
            let dist = Math.hypot(dx, dy);
            en.x += (dx/dist) * en.speed;
            en.y += (dy/dist) * en.speed;

            // Desenhar Inimigo
            ctx.fillStyle = '#444';
            ctx.beginPath();
            ctx.arc(en.x, en.y, en.radius, 0, Math.PI*2);
            ctx.fill();
            ctx.strokeStyle = '#ff0000';
            ctx.stroke();

            // Colisão Bala
            bullets.forEach((b, bi) => {
                if(Math.hypot(b.x - en.x, b.y - en.y) < en.radius + 5) {
                    createParticles(en.x, en.y, '#ff0000');
                    enemies.splice(i, 1);
                    bullets.splice(bi, 1);
                    score++;
                    playHitSound();
                    updateUI();
                }
            });

            // Dano no Jogador
            if(dist < player.radius + en.radius) {
                player.hp -= 0.5;
                shakeTime = 10;
                document.body.classList.add('shake');
                updateUI();
                if(player.hp <= 0) endGame();
            }
        });

        if(shakeTime > 0) {
            shakeTime--;
            if(shakeTime === 0) document.body.classList.remove('shake');
        }

        requestAnimationFrame(update);
    }

    function updateUI() {
        document.getElementById('hp-bar').style.width = player.hp + "%";
        document.getElementById('hp-val').innerText = Math.ceil(player.hp) + " HP";
        document.getElementById('score-label').innerText = "KILLS: " + score;
        
        let rank = "PLATINA";
        let color = "#fbbf24";
        if(score > 20) { rank = "DIAMANTE"; color = "#60a5fa"; }
        if(score > 50) { rank = "MESTRE"; color = "#ef4444"; }
        
        const label = document.getElementById('rank-label');
        label.innerText = rank;
        label.style.color = color;
    }

    function endGame() {
        gameRunning = false;
        document.getElementById('overlay').classList.remove('hidden');
        document.getElementById('overlay').querySelector('h1').innerText = "ELIMINADO";
        document.getElementById('overlay').querySelector('p').innerText = "SCORE FINAL: " + score;
    }

    resize();
</script>
</body>
</html>
